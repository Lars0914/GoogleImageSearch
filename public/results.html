<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Google Lens Image Search - Results</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.css" rel="stylesheet">
    <style>
        body {
            background: linear-gradient(135deg, #1a202c 0%, #2d3748 100%);
            min-height: 100vh;
            font-family: 'Inter', sans-serif;
            position: relative;
            padding-top: 4rem; /* Space for fixed button */
        }
        .back-button {
            position: fixed;
            top: 1rem;
            left: 50%;
            transform: translateX(-50%);
            background-color: #4a5568;
            color: #fff;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            text-decoration: none;
            z-index: 1001;
        }
        .back-button:hover {
            background-color: #2d3748;
        }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
            gap: 1.5rem;
            padding: 2rem;
            padding-top: 3rem; /* Offset for fixed button */
        }
        .result-card {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 1rem;
            padding: 1rem;
            transition: transform 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: 100%;
        }
        .result-card:hover {
            transform: translateY(-5px);
        }
        .result-image {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        .modal-content {
            background: rgba(45, 55, 72, 0.9);
            border-radius: 1rem;
            max-width: 90%;
            width: 300px;
            padding: 1.5rem;
            position: relative;
            color: #fff;
            display: flex;
            flex-direction: column;
            align-items: center;
            height: auto; /* Adjust height to content */
            max-height: 80vh; /* Limit max height */
            overflow-y: auto; /* Scroll if content overflows */
        }
        .modal-image {
            max-width: 100%;
            height: 200px;
            object-fit: cover;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
        }
        .close {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            font-size: 1.5rem;
            color: #fff;
            cursor: pointer;
        }
        @media (min-width: 640px) {
            .modal-content {
                width: 400px;
            }
        }
        @media (min-width: 1024px) {
            .modal-content {
                width: 500px;
            }
        }
    </style>
</head>
<body>
    <a href="/index.html" class="back-button">Back to Home</a>
    <div id="resultsContainer" class="grid-container"></div>
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <img id="modalImage" src="" alt="Modal Image" class="modal-image hidden">
            <h2 id="modalName" class="text-xl font-bold mb-2"></h2>
            <p><strong>Brand:</strong> <span id="modalBrand"></span></p>
            <p><strong>Product Type:</strong> <span id="modalProductType"></span></p>
            <p><strong>Hardware Material:</strong> <span id="modalHardwareMaterial"></span></p>
            <p><strong>Size:</strong> <span id="modalSize"></span></p>
            <p><strong>Estimated Value:</strong> <span id="modalEstimatedValue"></span></p>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/aos/2.3.4/aos.js"></script>
    <script>
        AOS.init({ duration: 800, once: true });

        const results = JSON.parse(localStorage.getItem('searchResults')) || [];
        const resultsContainer = document.getElementById('resultsContainer');
        const modal = document.getElementById('modal');
        const modalImage = document.getElementById('modalImage');
        const modalName = document.getElementById('modalName');
        const modalBrand = document.getElementById('modalBrand');
        const modalProductType = document.getElementById('modalProductType');
        const modalHardwareMaterial = document.getElementById('modalHardwareMaterial');
        const modalSize = document.getElementById('modalSize');
        const modalEstimatedValue = document.getElementById('modalEstimatedValue');

        // Function to analyze image and generate product data
        function analyzeImageAndGenerateData(imageUrl, title) {
            // Simulate image analysis based on thumbnail URL and title (since direct image processing isn't possible here)
            // This is a placeholder; in a real scenario, I'd use xAI's image analysis capabilities
            return new Promise((resolve) => {
                const img = new Image();
                img.crossOrigin = "Anonymous";
                img.src = imageUrl;

                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    canvas.width = img.width;
                    canvas.height = img.height;
                    ctx.drawImage(img, 0, 0);

                    // Simulate image content analysis (e.g., color, shape, text)
                    const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);
                    const isShiny = imageData.data.some((value, index) => index % 4 === 0 && value > 200); // Rough check for bright/reflective surfaces
                    const hasStraps = title.toLowerCase().includes('strap') || title.toLowerCase().includes('band');
                    const hasRoundShape = canvas.width / canvas.height > 0.8 && canvas.width / canvas.height < 1.2;

                    let productType = 'Other';
                    let materials = ['Unknown'];
                    let sizes = ['Unknown'];
                    let priceRanges = [50, 300];

                    // Infer product type based on image characteristics and title
                    if (title.toLowerCase().includes('watch') || (hasRoundShape && isShiny)) {
                        productType = 'Watch';
                        materials = ['Oystersteel', '18k Gold', 'Stainless Steel'];
                        sizes = ['37mm', '40mm', '44mm'];
                        priceRanges = [5000, 75000];
                    } else if (title.toLowerCase().includes('shoe') || title.toLowerCase().includes('sneaker') || title.toLowerCase().includes('boot')) {
                        productType = 'Shoe';
                        materials = ['Synthetics, Mesh', 'Leather, Rubber', 'Suede'];
                        sizes = ['US 5-15', 'EU 36-46', 'UK 4-12'];
                        priceRanges = [50, 2000];
                    } else if (title.toLowerCase().includes('dress') || title.toLowerCase().includes('gown')) {
                        productType = 'Dress';
                        materials = ['Tweed, Silk', 'Chiffon, Pearls', 'Satin'];
                        sizes = ['S-XXL', '2-14', '36-44'];
                        priceRanges = [1000, 100000];
                    } else if (title.toLowerCase().includes('wallet') || title.toLowerCase().includes('billfold')) {
                        productType = 'Wallet';
                        materials = ['Leather, Canvas', 'Metal Hardware', 'Suede Lining'];
                        sizes = ['10x15cm', '12x10cm', '15x8cm'];
                        priceRanges = [285, 6885];
                    } else if (title.toLowerCase().includes('jewelry') || title.toLowerCase().includes('necklace') || title.toLowerCase().includes('bracelet') || title.toLowerCase().includes('ring')) {
                        productType = 'Jewelry';
                        materials = ['Gold, Diamonds', 'Silver, Gemstones', 'Platinum'];
                        sizes = ['Adjustable', '18-20in', '7-9'];
                        priceRanges = [1000, 50000];
                    } else if (title.toLowerCase().includes('handbag') || title.toLowerCase().includes('purse') || title.toLowerCase().includes('tote') || title.toLowerCase().includes('clutch') || hasStraps) {
                        productType = 'Handbag';
                        materials = ['Leather, Metal', 'Canvas, Gold Hardware', 'Patent Leather, Ruthenium'];
                        sizes = ['25x15x10cm', '30x20x10cm', '35x25x15cm'];
                        priceRanges = [500, 5000];
                    } else if (title.toLowerCase().includes('belt') || title.toLowerCase().includes('waistbelt')) {
                        productType = 'Belt';
                        materials = ['Leather, Buckle', 'Canvas, Brass'];
                        sizes = ['30-40in', '80-100cm'];
                        priceRanges = [50, 500];
                    } else if (title.toLowerCase().includes('hat') || title.toLowerCase().includes('cap') || title.toLowerCase().includes('beanie')) {
                        productType = 'Hat';
                        materials = ['Wool, Cotton', 'Straw, Leather'];
                        sizes = ['S-M', 'One Size'];
                        priceRanges = [20, 200];
                    } else if (title.toLowerCase().includes('eyewear') || title.toLowerCase().includes('sunglasses') || title.toLowerCase().includes('glasses')) {
                        productType = 'Eyewear';
                        materials = ['Acetate, Metal', 'Plastic, Polarized Lens'];
                        sizes = ['52-58mm lens'];
                        priceRanges = [50, 500];
                    } else if (title.toLowerCase().includes('glove') || title.toLowerCase().includes('mittens')) {
                        productType = 'Glove';
                        materials = ['Leather, Wool', 'Cotton, Rubber'];
                        sizes = ['S-L'];
                        priceRanges = [20, 100];
                    } else if (title.toLowerCase().includes('scarf') || title.toLowerCase().includes('shawl')) {
                        productType = 'Scarf';
                        materials = ['Silk, Wool', 'Cashmere'];
                        sizes = ['70x200cm', '180x30cm'];
                        priceRanges = [50, 300];
                    } else if (title.toLowerCase().includes('cosmetic') || title.toLowerCase().includes('makeup') || title.toLowerCase().includes('lipstick') || title.toLowerCase().includes('foundation')) {
                        productType = 'Cosmetic';
                        materials = ['Vegan Ingredients', 'Organic Compounds'];
                        sizes = ['30ml', '50g'];
                        priceRanges = [10, 100];
                    } else if (title.toLowerCase().includes('chair') || title.toLowerCase().includes('table') || title.toLowerCase().includes('lamp') || title.toLowerCase().includes('sofa') || title.toLowerCase().includes('bed')) {
                        productType = 'Household';
                        materials = ['Wood, Metal', 'Glass, Fabric'];
                        sizes = ['Standard', 'Queen', '120x60cm'];
                        priceRanges = [50, 1000];
                    } else {
                        // Fallback for unclassified items
                        productType = 'Other';
                        materials = ['Mixed Materials'];
                        sizes = ['Varies'];
                        priceRanges = [10, 1000];
                    }

                    const brands = ['Gucci', 'Prada', 'Louis Vuitton', 'Chanel', 'Hermès', 'Dior', 'Coach', 'Michael Kors', 'Kate Spade', 'Tory Burch', 'Rolex', 'Cartier', 'Nike', 'Adidas', 'Generic'];
                    const detectedBrand = brands.find(b => title.toLowerCase().includes(b.toLowerCase())) || 'Generic';

                    const [minPrice, maxPrice] = priceRanges;
                    const hardwareMaterial = materials[Math.floor(Math.random() * materials.length)];
                    const size = sizes[Math.floor(Math.random() * sizes.length)];
                    const estimatedValue = `US$${minPrice.toLocaleString('en-US')} - US$${maxPrice.toLocaleString('en-US')} (estimated value without considering the condition)`;

                    resolve({
                        brand: detectedBrand,
                        name: title.split(' ').slice(0, 3).join(' ').replace(detectedBrand, '').trim() || `${detectedBrand} ${productType}`,
                        hardwareMaterial,
                        productType,
                        size,
                        estimatedValue
                    });
                };

                img.onerror = () => {
                    resolve({
                        brand: 'Generic',
                        name: title.split(' ').slice(0, 3).join(' ') || 'Unknown Item',
                        hardwareMaterial: 'Unknown',
                        productType: 'Other',
                        size: 'Unknown',
                        estimatedValue: 'US$50 - US$300 (estimated value without considering the condition)'
                    });
                };
            });
        }

        // Globally defined functions
        function openModal(productData, thumbnail, link) {
            const modalBody = document.querySelector('#modalBody');
            modalBody.innerHTML = `
                <img src="${thumbnail}" alt="${productData.name}" class="w-full h-64 object-cover rounded-lg mb-4">
                <h2 class="text-2xl font-bold text-white mb-2">${productData.name}</h2>
                <p class="text-gray-300 mb-2"><strong>Brand:</strong> ${productData.brand}</p>
                <p class="text-gray-300 mb-2"><strong>Product Type:</strong> ${productData.productType}</p>
                <p class="text-gray-300 mb-2"><strong>Hardware Material:</strong> ${productData.hardwareMaterial}</p>
                <p class="text-gray-300 mb-2"><strong>Size:</strong> ${productData.size}</p>
                <p class="text-xl font-semibold text-white mb-4"><strong>Estimated Value:</strong> ${productData.estimatedValue}</p>
                <div class="flex space-x-4">
                    <a href="${link}" target="_blank" class="bg-indigo-600 text-white px-4 py-2 rounded-lg hover:bg-indigo-700">View Source</a>
                    <button class="bg-teal-600 text-white px-4 py-2 rounded-lg hover:bg-teal-700">Add to Cart</button>
                </div>
            `;
            modalOverlay.style.display = 'flex';
        }

        function closeModal() {
            modalOverlay.style.display = 'none';
        }

        if (results.length > 0) {
            results.forEach((element, index) => {
                analyzeImageAndGenerateData(element.thumbnail, element.title).then(productData => {
                    const card = document.createElement('div');
                    card.className = 'card';
                    card.setAttribute('data-aos', index % 2 === 0 ? 'fade-up' : 'zoom-in');
                    card.setAttribute('data-aos-delay', `${index * 100}`);
                    card.innerHTML = `
                        <img src="${element.thumbnail}" alt="${productData.name}">
                        <div class="card-content">
                            <a href="${element.link}" target="_blank">${productData.name}</a>
                            <p class="text-white font-semibold">${productData.estimatedValue}</p>
                            <button class="quick-view-btn bg-teal-600 text-white px-4 py-2 rounded-lg mt-2 hover:bg-teal-700" onclick="openModal(${JSON.stringify(productData)}, '${element.thumbnail}', '${element.link}')">Quick View</button>
                        </div>
                    `;
                    resultBox.appendChild(card);
                });
            });
        } else {
            noResults.classList.remove('hidden');
        }
    </script>
</body>
</html>